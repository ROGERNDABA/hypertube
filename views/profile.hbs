<link rel="stylesheet" href="/stylesheets/user_profile.css">
<script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<link rel="stylesheet" href="/stylesheets/croppie.css" />
<script src="/javascripts/croppie.js"></script>


<div class="col-lg-6 col-sm-6">
	<div class="card hovercard">
		<div class="useravatar">
			<img alt="" src="/images/avatar.png">
		</div>
		<div class="card-info"> <span class="card-title">Pamela Anderson</span>

		</div>
	</div>

	<div class="middle-card card text-center">
		{{#if mail}}
			<div id="errors" class="alert alert-danger" role="alert">{{mail}}</div>
		{{else if user}}
			<div id="errors" class="alert alert-danger" role="alert">{{user}}</div>
		{{/if}}
		{{#if errors}}
			<div id="errors" class="alert alert-danger" role="alert">
				{{#each errors}}
					<li class="err_li">{{this.msg}}</li>
				{{/each}}
			</div>
		{{/if}}
		<div id="err_msg" style="display:none" class="alert alert-danger" role="alert"> </div>
		<div class="card-header">
			<ul class="nav nav-tabs card-header-tabs">
				<li class="watched nav-item nav-link active">
					watched movies
				</li>
				<li class="upadte-profile nav-item nav-link">
					upadte profile
				</li>
				<li class="nav-item nav-link">
				</li>
			</ul>
		</div>

		<div class="card-body">
			<div class="card card-signin my-5">
				<div class="col-sm-9 col-md-7 col-lg-5 mx-auto">
					<form id="form" class="form-signin" method="post" action="/user/update">
						<div class="avatar-cont text-center">
							<img src="/images/avatar.png" alt="Avatar" class="avatar">
							<i class="fas fa-plus plus"></i>
							<input type="file" name="pic" accept="image/*" style="display:none;">
						</div>
						<hr class="my-4">

						<!-- firstname -->

						<div class="input-group">
							<span class="input-group-addon"><input type="checkbox" value="firstname"></span>
							<input type="text" name="firstname" id="firstname" class="form-control" placeholder="firstname" {{#if firstname}} value="{{firstname}}" {{/if}}>
						</div>

						<!-- lastname -->

						<div class="input-group">
							<span class="input-group-addon"><input type="checkbox" value="lastname"></span>
							<input type="text" name="lastname" id="lastname" class="form-control" disabled="disabled" placeholder="lastname" {{#if lastname}} value="{{lastname}}" {{/if}}>
						</div>

						<!-- username -->

						<div class="input-group">
							<span class="input-group-addon"><input type="checkbox" value="username"></span>
							<input type="text" name="username" id="username" class="form-control" disabled="disabled" placeholder="username" {{#if username}} value="{{username}}" {{/if}}>
						</div>

						<!-- email -->

						<div class="input-group">
							<span class="input-group-addon"><input type="checkbox" value="email"></span>
							<input type="email" name="email" id="email" disabled="disabled" class="form-control" placeholder="email" {{#if email}} value="{{email}}" {{/if}}>
						</div>

						<!-- passwords -->

						<div class="input-group">
							<span class="input-group-addon"><input type="checkbox" value="password"></span>
							<input name="password1" type="password" id="password1" disabled="disabled" class="form-control" placeholder="password">
							<div class="bar"></div>
						</div>
						<div class="input-group">
							<span class="input-group-addon" style="width:39px;background-color:transparent;border:none;"></span>
							<input name="password2" type="password" id="password2" disabled="disabled" class="form-control" placeholder="confirm password">
						</div>


						<button id="submit" class="btn btn-lg btn-primary btn-block" type="submit"> <span>save changes</span> </button>

						<a href="/home" class="btn-block"><button id="cancel" class="btn btn-lg btn-primary btn-block" type="button"> <span>cancel</span> </button></a>
						<input type="text" style="display:none" name="" value="">
					</form>
				</div>
				{{!-- </div> --}}
			</div>
		</div>
	</div>

</div>

{{!-- <div style="width:500px;height:500px;background-color:red" id="upload-demo" class="">
</div>

<button type="button" name="button"></button>

<p></p> --}}
{{!-- <img src="" alt="" id="the_img"> --}}
{{!-- <img src="/images/logo.png" width="300" height="300" alt="" class="the_img"> --}}

<script>
	$('.nav-item').on('click', function() {
		$('.nav-item').removeClass('active');
		$(this).addClass('active');
		if ($(this).hasClass('class-1')) {
			alert('yes 1');
		}
	})

	$('document').ready(function() {

		$('input:checkbox').on('click', function() {
			if ($(this).prop('checked')) {
				if ($(this).val() == 'password') {
					$('#' + $(this).val() + '1').attr('disabled', false);
					$('#' + $(this).val() + '2').attr('disabled', false);
				} else {
					$('#' + $(this).val()).attr('disabled', false);
				}
			} else {
				if ($(this).val() == 'password') {
					$('#' + $(this).val() + '1').attr('disabled', true);
					$('#' + $(this).val() + '2').attr('disabled', true);
					// $('#' + $(this).val() + '1').val('');
					// $('#' + $(this).val() + '2').val('');
				} else {
					$('#' + $(this).val()).attr('disabled', true);
					// $('#' + $(this).val()).val(arr[$(this).val()]);
				}
			}
		})

		$('.form-control').on('input', function() {
			var firstname = $('#firstname').val(),
				lastname = $('#lastname').val(),
				username = $('#username').val(),
				email = $('#email').val(),
				p1 = $('#password1').val(),
				p2 = $('#password2').val();
			tex = '';
			var reg = /^[a-z]+$/i;
			var regU = /^[a-z0-9_]+$/i;
			var regem = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;


			if (this.name === 'email' && email && email.match(regem)) {
				console.log(this.value);
				var data = {};
				data.email = this.value;
				$.ajax({
					type: 'POST',
					data: JSON.stringify(data),
					contentType: 'application/json',
					url: '/user/update/email',
					success: function(res) {
						console.log(res)
					}
				});
			}
			if (this.name === 'username' && username && username.match(regU)) {
				console.log(this.value);
				var data = {};
				data.username = this.value;
				$.ajax({
					type: 'POST',
					data: JSON.stringify(data),
					contentType: 'application/json',
					url: '/user/update/username',
					success: function(res) {
						console.log(res)
					}
				});
			}
			if (firstname && !firstname.match(reg))
				tex += '- only letters on firstname field<br>';
			if (lastname && !lastname.match(reg))
				tex += '- only letters on lastname field<br>';
			if (username && !username.match(regU))
				tex += '- only numbers, letters and underscore on username field<br>';
			if (email && !email.match(regem)) {
				tex += '- email should have formart login@domain.ext<br>';
			}
			if (p1 && p1.length < 6)
				tex += '- password too short<br>';
			if (p2 && !(p1 == p2))
				tex += '- passwords don\'t match<br>';
			if (tex) {
				$('#err_msg').css('display', 'block');
			} else {
				$('#err_msg').css('display', 'none');
			}
			$('#err_msg').html(tex);

		});

		$('.plus').on('click', function() {
			$('input:file').click();
		});

		$('input:file').change(function(e) {
			var file = event.target.files[0];
			// console.log(file);
			var reader = new FileReader();

			reader.onload = function(e) {
				$('.avatar').attr('src', e.target.result);
			}
			reader.readAsDataURL(file);
			// reader
		})

		// 	var uploadCrop;
		//
		//
		//
		// 	uploadCrop = $('#upload-demo').croppie({
		// 		viewport: {
		// 			width: 200,
		// 			height: 200,
		// 			type: 'square'
		// 		},
		// 		enableExif: true,
		// 		showZoomer: false
		// 	});
		//
		//
		// 	uploadCrop.croppie('bind', {
		// 		url: '/images/logo.png'
		// 	})
		//
		// 	$('button').on('click', function() {
		// 		uploadCrop.croppie('result', {
		// 			type: 'base64'
		// 		}).then(function(g) {
		// 			// html is div (overflow hidden)
		// 			console.log(g);
		// 			$('#the_img').attr('src', g);
		// 			// with img positioned inside.
		// 		});
		// 	})
		//
		// 	function saveImg() {}
		//
	});
</script>